<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>pygengraph - Processing GFA produced by CuttleFish compacted de Bruijn graph constructor</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="pygengraph - Processing GFA produced by CuttleFish compacted de Bruijn graph constructor">
<meta property="og:site-name" content="pygengraph">
<meta name="twitter:title" content="pygengraph - Processing GFA produced by CuttleFish compacted de Bruijn graph constructor">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">pygengraph</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Processing GFA produced by CuttleFish compacted de Bruijn graph constructor</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">pygengraph</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./init.html" class="sidebar-item-text sidebar-link">Synteny module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./graph.html" class="sidebar-item-text sidebar-link">Graph module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tree.html" class="sidebar-item-text sidebar-link">Tree module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./synteny.html" class="sidebar-item-text sidebar-link">Synteny module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">Utils module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./export.html" class="sidebar-item-text sidebar-link">Export module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scripts.html" class="sidebar-item-text sidebar-link">Script module</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">docs</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  docs/index.html
  </li>
          <li class="sidebar-item">
  docs/CONTRIBUTING.html
  </li>
          <li class="sidebar-item">
  docs/debruijngraphprocessing.html
  </li>
          <li class="sidebar-item">
  docs/dev.html
  </li>
          <li class="sidebar-item">
  docs/export.html
  </li>
          <li class="sidebar-item">
  docs/graph.html
  </li>
          <li class="sidebar-item">
  docs/init.html
  </li>
          <li class="sidebar-item">
  docs/scripts.html
  </li>
          <li class="sidebar-item">
  docs/synteny.html
  </li>
          <li class="sidebar-item">
  docs/tree.html
  </li>
          <li class="sidebar-item">
  docs/utils.html
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#loading-graph" id="toc-loading-graph" class="nav-link active" data-scroll-target="#loading-graph">Loading graph</a></li>
  <li><a href="#inverting-necessary-nodes" id="toc-inverting-necessary-nodes" class="nav-link" data-scroll-target="#inverting-necessary-nodes">Inverting necessary nodes</a></li>
  <li><a href="#removing-overlaps" id="toc-removing-overlaps" class="nav-link" data-scroll-target="#removing-overlaps">Removing overlaps</a>
  <ul class="collapse">
  <li><a href="#removing-nodes-functionality" id="toc-removing-nodes-functionality" class="nav-link" data-scroll-target="#removing-nodes-functionality">Removing nodes functionality</a></li>
  <li><a href="#finding-and-clearing-overlaps" id="toc-finding-and-clearing-overlaps" class="nav-link" data-scroll-target="#finding-and-clearing-overlaps">Finding and clearing overlaps</a></li>
  <li><a href="#removing-empty-nodes" id="toc-removing-empty-nodes" class="nav-link" data-scroll-target="#removing-empty-nodes">Removing empty nodes</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-git"></i></div><div class="action-links"><p><a href="https://gitlab.com/pigrenok/pygengraph/tree/master/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Processing GFA produced by CuttleFish compacted de Bruijn graph constructor</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nbdev <span class="im">import</span> nbdev_export</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>nbdev_export()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cProfile</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pstats</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pstats <span class="im">import</span> SortKey</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> random <span class="im">import</span> shuffle</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygengraph.graph <span class="im">import</span> GenomeGraph,initialPathAnalysis,calcNodeLengths</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygengraph.utils <span class="im">import</span> inverseSequence</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(<span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="loading-graph" class="level2">
<h2 class="anchored" data-anchor-id="loading-graph">Loading graph</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>notebook2script()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Converted 00_init.ipynb.
Converted 01_graph.ipynb.
Converted 02_tree.ipynb.
Converted 03_synteny.ipynb.
Converted 04_utils.ipynb.
Converted 05_export.ipynb.
Converted deBruijnGraphProcessing.ipynb.
Converted index.ipynb.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> <span class="st">'../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/nextStageTest.gfa'</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># paths = '../../1001G/pantograph/data/AT_Chr1_OGOnly_new.gfa'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dirpath <span class="op">=</span> <span class="st">'../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># paths = '../../1001G/pantograph/data/AT_Chr1_OGOnly_new.gfa'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path <span class="kw">in</span> glob.glob(<span class="ss">f'</span><span class="sc">{</span>dirpath<span class="sc">}{</span>os<span class="sc">.</span>path<span class="sc">.</span>sep<span class="sc">}</span><span class="ss">*.gfa'</span>):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    graph <span class="op">=</span> GenomeGraph(gfaPath<span class="op">=</span>path)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     dirpath = os.path.dirname(path)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    fileList <span class="op">=</span> os.path.splitext(os.path.basename(path))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    suffix <span class="op">=</span> <span class="st">'clean'</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    graph.toGFA(<span class="ss">f'</span><span class="sc">{</span>dirpath<span class="sc">}{</span>os<span class="sc">.</span>path<span class="sc">.</span>sep<span class="sc">}{</span>fileList[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>suffix<span class="sc">}{</span>fileList[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/partial_transpose_common_mid.gfa
Loading segment 7/7
Loading segments finished.
Loading link 8/8
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 7/7
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Node 2 inverted
Node 3 inverted
Node 4 inverted
Node 7 inverted
Constructing Tremaux tree
Node: 1
Graph edges: [(7, 1)]
Tree edges: []
Edge to keep: (7, 1)
Cycle found!
Path to break: [1, 2, 3, 7]
Unbreakable path!
Node: 1
Graph edges: [(7, 1)]
Tree edges: []
Edge to keep: (7, 1)
Cycle found!
Path to break: [1, 2, 3, 7]
Unbreakable path!
Done!
Getting root nodes
Start Loop...
0 - 0 - 1 - 1 - 2
0 - 1 - 2 - 2 - 3
1 - 2 - 3 - 3 - 7
0 - 3 - 4 - 3 - 5
0 - 4 - 5 - 5 - 6
0 - 5 - 6 - 6 - 4
Calculating nodes length...
Processing node 7/7
Finished calculating nodes lengths
Calculating nodes length...
Processing node 7/7
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/fully_inverted.gfa
Loading segment 1/1
Loading segments finished.

Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 1/1
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/mid_block_inverted.gfa
Loading segment 7/7
Loading segments finished.
Loading link 8/8
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 7/7
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Node 2 inverted
Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
1 - 0 - 1 - 1 - 4
0 - 1 - 2 - 1 - 2
0 - 2 - 3 - 2 - 3
1 - 3 - 4 - 3 - 7
0 - 4 - 5 - 3 - 5
0 - 5 - 6 - 5 - 6
Calculating nodes length...
Processing node 7/7
Finished calculating nodes lengths
Calculating nodes length...
Processing node 7/7
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/end_block_inverted.gfa
Loading segment 4/4
Loading segments finished.
Loading link 4/4
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Node 2 inverted
Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
1 - 0 - 1 - 1 - 4
0 - 1 - 2 - 1 - 2
0 - 2 - 3 - 2 - 3
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/substitution_mid.gfa
Loading segment 4/4
Loading segments finished.
Loading link 4/4
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
1 - 0 - 1 - 1 - 3
0 - 1 - 2 - 1 - 2
0 - 2 - 3 - 2 - 4
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/end_block_indel.gfa
Loading segment 2/2
Loading segments finished.
Loading link 1/1
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 2/2
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Node 2 inverted
Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
0 - 0 - 1 - 1 - 2
Calculating nodes length...
Processing node 2/2
Finished calculating nodes lengths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/full_copy.gfa
Loading segment 4/4
Loading segments finished.
Loading link 5/5
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Node 2 inverted
Node 3 inverted
Constructing Tremaux tree
Node: 2
Graph edges: [(1, 2), (3, 2)]
Tree edges: [(3, 2)]
Edge to keep: (1, 2)
Cycle found!
Path to break: [2, 4, 1]
Unbreakable path!
Node: 2
Graph edges: [(1, 2), (3, 2)]
Tree edges: [(3, 2)]
Edge to keep: (1, 2)
Cycle found!
Path to break: [2, 4, 1]
Unbreakable path!
Done!
Getting root nodes
Start Loop...
0 - 0 - 1 - 3 - 2
0 - 1 - 2 - 2 - 4
0 - 2 - 3 - 4 - 1
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/partial_copy_common_mid.gfa
Loading segment 3/3
Loading segments finished.
Loading link 4/4
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Constructing Tremaux tree
Node: 1
Graph edges: [(3, 1)]
Tree edges: []
Edge to keep: (3, 1)
Cycle found!
Path to break: [1, 2, 3]
Unbreakable path!
Node: 1
Graph edges: [(3, 1)]
Tree edges: []
Edge to keep: (3, 1)
Cycle found!
Path to break: [1, 2, 3]
Unbreakable path!
Done!
Getting root nodes
Start Loop...
0 - 0 - 1 - 1 - 2
0 - 1 - 2 - 2 - 3
Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths
Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/partial_transpose_common_end.gfa
Loading segment 7/7
Loading segments finished.
Loading link 8/8
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 7/7
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Node 2 inverted
Node 3 inverted
Node 7 inverted
Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
1 - 0 - 1 - 1 - 4
1 - 1 - 2 - 4 - 6
1 - 1 - 2 - 1 - 2
1 - 2 - 3 - 2 - 3
1 - 3 - 4 - 3 - 5
0 - 4 - 5 - 4 - 6
0 - 5 - 6 - 6 - 7
Calculating nodes length...
Processing node 7/7
Finished calculating nodes lengths
Calculating nodes length...
Processing node 7/7
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/partial_copy_common_end.gfa
Loading segment 3/3
Loading segments finished.
Loading link 4/4
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 2 inverted
Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
0 - 0 - 1 - 1 - 2
0 - 1 - 2 - 2 - 3
Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths
Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/partial_transpose_common_both_ends.gfa
Loading segment 10/10
Loading segments finished.
Loading link 12/12
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 10/10
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 8 inverted
Node 9 inverted
Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
1 - 0 - 1 - 1 - 3
1 - 1 - 2 - 3 - 7
2 - 2 - 3 - 7 - 6
1 - 3 - 4 - 7 - 8
1 - 4 - 5 - 8 - 10
1 - 4 - 5 - 1 - 2
1 - 5 - 6 - 2 - 4
2 - 6 - 7 - 4 - 5
1 - 7 - 8 - 4 - 9
0 - 8 - 9 - 8 - 10
Calculating nodes length...
Processing node 10/10
Finished calculating nodes lengths
Calculating nodes length...
Processing node 10/10
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/equal.gfa
Loading segment 1/1
Loading segments finished.

Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 1/1
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/mid_block_indel.gfa
Loading segment 4/4
Loading segments finished.
Loading link 4/4
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
1 - 0 - 1 - 1 - 3
0 - 1 - 2 - 1 - 2
0 - 2 - 3 - 2 - 4
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/full_transpose.gfa
Loading segment 4/4
Loading segments finished.
Loading link 4/4
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Node 2 inverted
Node 3 inverted
Node 4 inverted
Constructing Tremaux tree
Node: 1
Graph edges: [(3, 1)]
Tree edges: []
Edge to keep: (3, 1)
Cycle found!
Path to break: [1, 2, 4, 3]
Unbreakable path!
Node: 1
Graph edges: [(3, 1)]
Tree edges: []
Edge to keep: (3, 1)
Cycle found!
Path to break: [1, 2, 4, 3]
Unbreakable path!
Done!
Getting root nodes
Start Loop...
0 - 0 - 1 - 1 - 2
0 - 1 - 2 - 2 - 4
0 - 2 - 3 - 4 - 3
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/substitution_end.gfa
Loading segment 3/3
Loading segments finished.
Loading link 2/2
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 1 inverted
Node 2 inverted
Node 3 inverted
Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
1 - 0 - 1 - 1 - 3
0 - 1 - 2 - 1 - 2
Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths
Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/partial_copy_common_both_ends.gfa
Loading segment 4/4
Loading segments finished.
Loading link 6/6
Loading links finished
Loading path 2/2
Loading paths finished. 2 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
Node 2 inverted
Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
0 - 0 - 1 - 1 - 2
1 - 1 - 2 - 2 - 4
0 - 2 - 3 - 2 - 3
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Calculating nodes length...
Processing node 4/4
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> GenomeGraph(gfaPath<span class="op">=</span>paths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loading graph from ../../1001G/GraphGeneration/TestingPipelines/data/cuttlefish/out/nextStageTest.gfa
Loading segment 29/29
Loading segments finished.
Loading link 98/98
Loading links finished
Loading path 7/7
Loading paths finished. 7 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 29/29
Finished calculating nodes lengths
Preprocessing paths...
Processing path 7/7
Finished preprocessing paths
Node 2 inverted
Node 3 inverted
Node 4 inverted
Node 6 inverted
Node 10 inverted
Node 11 inverted
Node 14 inverted
Node 16 inverted
Node 21 inverted
Node 22 inverted
Node 23 inverted
Node 24 inverted
Node 28 inverted
Constructing Tremaux tree
Node: 1
Graph edges: [(3, 1), (7, 1)]
Tree edges: []
Edge to keep: (3, 1)
Cycle found!
Path to break: [1, 2, 4, 19, 20, 12, 28, 15, 17, 3]
Unbreakable path!
Node: 10
Graph edges: [(9, 10), (13, 10), (14, 10), (21, 10)]
Tree edges: [(13, 10)]
Edge to keep: (14, 10)
Cycle found!
Path to break: [10, 9, 29, 25, 8, 22, 23, 14]
Edge substituted!
Edge (20, 22) substitute edge (8, 22)
Node: 1
Graph edges: [(3, 1), (7, 1)]
Tree edges: []
Edge to keep: (3, 1)
Cycle found!
Path to break: [1, 3]
Unbreakable path!
Node: 22
Graph edges: [(8, 22), (11, 22), (18, 22), (20, 22)]
Tree edges: [(20, 22)]
Edge to keep: (8, 22)
Cycle found!
Path to break: [22, 23, 14, 10, 9, 29, 25, 8]
Edge substituted!
Edge (21, 10) substitute edge (14, 10)
Node: 10
Graph edges: [(9, 10), (13, 10), (14, 10), (21, 10)]
Tree edges: [(21, 10)]
Edge to keep: (14, 10)
Cycle found!
Path to break: [10, 9, 29, 25, 8, 22, 23, 14]
Edge substituted!
Edge (20, 22) substitute edge (8, 22)
Done!
Getting root nodes
Start Loop...
2 - 0 - 1 - 1 - 3
2 - 1 - 2 - 3 - 17
2 - 1 - 2 - 1 - 2
2 - 2 - 3 - 2 - 4
3 - 3 - 4 - 4 - 19
3 - 4 - 5 - 19 - 20
4 - 5 - 6 - 20 - 22
4 - 6 - 7 - 22 - 23
5 - 7 - 8 - 23 - 14
5 - 8 - 9 - 14 - 10
5 - 8 - 9 - 1 - 21
4 - 9 - 10 - 14 - 10
5 - 10 - 11 - 10 - 9
5 - 11 - 12 - 9 - 29
5 - 12 - 13 - 29 - 25
5 - 12 - 13 - 23 - 24
4 - 13 - 14 - 29 - 25
5 - 14 - 15 - 25 - 26
6 - 15 - 16 - 26 - 7
5 - 16 - 17 - 26 - 27
4 - 17 - 18 - 25 - 8
3 - 18 - 19 - 10 - 13
2 - 19 - 20 - 20 - 12
2 - 20 - 21 - 12 - 28
2 - 21 - 22 - 28 - 15
1 - 22 - 23 - 4 - 5
0 - 23 - 24 - 3 - 17
2 - 24 - 25 - 17 - 11
1 - 25 - 26 - 17 - 16
1 - 26 - 27 - 16 - 6
0 - 27 - 28 - 17 - 18
&gt; /data/YandexDisk/Kew/src/graphConstruction/pangraph_constructor/graph.py(159)__init__()
    157             self.treeSort()
    158             pdb.set_trace()
--&gt; 159             self.removeOverlaps()
    160 
    161     # check edgePaths calculation. Incorrectly calculates the numbers
</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>ipdb&gt;  self.nodes</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>['24290', '8931', '1137', '14693', '1099', '20952', '13261', '10453', '1614', '9478', '22619', '16558', '19628', '22113', '10684', '20353', '21183', '24207', '4434', '9923', '1416', '16345', '10152', '5985', '2318', '11400', '3056', '20959', '1015']</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>ipdb&gt;  [f'i:{self.nodes[el]}' for i,el in self.order]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>*** TypeError: cannot unpack non-iterable int object</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>ipdb&gt;  [f'i:{self.nodes[el]}' for i,el in enumerate(self.order)]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>*** NameError: name 'self' is not defined</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>ipdb&gt;  self.order</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1, 3, 2, 4, 19, 20, 22, 23, 14, 21, 10, 9, 29, 24, 25, 26, 7, 27, 8, 13, 12, 28, 15, 5, 17, 11, 16, 6, 18]</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>ipdb&gt;  self.forwardLinks</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>{1: {'+': [(2, '+'), (3, '+')], '-': [(21, '+')]}, 2: {'+': [(4, '-')]}, 3: {'-': [(1, '-')], '+': [(17, '+')]}, 17: {'+': [(11, '+'), (16, '+')], '-': [(18, '+'), (3, '-')]}, 9: {'+': [(29, '+'), (5, '+')], '-': [(10, '-')]}, 29: {'+': [(25, '+')]}, 25: {'+': [(26, '+'), (8, '+')]}, 4: {'+': [(19, '+')], '-': [(5, '-')]}, 5: {'-': [(9, '-')], '+': [(4, '+')]}, 16: {'-': [(17, '-')], '+': [(13, '-'), (6, '+')]}, 13: {'-': [(10, '+')], '+': [(16, '-')]}, 10: {'-': [(13, '+')], '+': [(9, '+')]}, 6: {'+': [(4, '+')]}, 26: {'+': [(7, '+'), (27, '+')]}, 7: {'+': [(1, '+')]}, 8: {'+': [(22, '-')]}, 22: {'+': [(23, '+')], '-': [(20, '-'), (11, '-')]}, 19: {'+': [(20, '+')]}, 11: {'-': [(17, '-')], '+': [(22, '+')]}, 20: {'-': [(12, '+')], '+': [(22, '+')]}, 12: {'+': [(28, '+')]}, 28: {'+': [(15, '+')]}, 23: {'+': [(14, '+'), (24, '+')]}, 14: {'+': [(10, '+')]}, 15: {'+': [(17, '-')]}, 18: {'+': [(22, '+')]}, 21: {'+': [(10, '+')]}, 24: {'+': [(25, '+')]}, 27: {'+': [(28, '+')]}}</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>ipdb&gt;  calcNodeLengths(self)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Calculating nodes length...
Processing node 29/29
Finished calculating nodes lengths
[3000, 59, 59, 3001, 59, 59, 59, 60, 3001, 3030, 60, 58, 59, 58, 60, 31, 3001, 59, 57, 32, 60, 3000, 32, 58, 3000, 31, 59, 3000, 59]</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>ipdb&gt;  q</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>BdbQuit: </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pdb</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>pdb.pm()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; /data/YandexDisk/Kew/src/graphConstruction/pangraph_constructor/graph.py(813)&lt;listcomp&gt;()
    811 
    812         for pathID in range(len(self.paths)):
--&gt; 813             self.paths[pathID] = [f'{offsetDict[int(el[:-1])-1]+1}{el[-1]}' for el in self.paths[pathID]]
    814 
    815         print('paths')
</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>ipdb&gt;  pathID</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>*** NameError: name 'pathID' is not defined</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>ipdb&gt;  u</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt; /data/YandexDisk/Kew/src/graphConstruction/pangraph_constructor/graph.py(813)_clearNodes()
    811 
    812         for pathID in range(len(self.paths)):
--&gt; 813             self.paths[pathID] = [f'{offsetDict[int(el[:-1])-1]+1}{el[-1]}' for el in self.paths[pathID]]
    814 
    815         print('paths')
</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>ipdb&gt;  pathID</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>1</code></pre>
</div>
<div class="cell-output cell-output-stdin">
<pre><code>ipdb&gt;  q</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>nodeLengths <span class="op">=</span> calcNodeLengths(graph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>graph.nodes,graph.nodeNameToID,graph.forwardLinks,nodeLengths,graph.order,graph.paths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(['2887', '4954', '3502'],
 {'2887': 1, '4954': 2, '3502': 3},
 {1: {'+': [(2, '+')]}, 2: {'+': [(3, '+'), (2, '+')]}},
 [3000, 3000, 3000],
 [1, 2, 3],
 [['1+', '2+', '3+'], ['1+', '2+', '2+', '3+']])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dirpath <span class="op">=</span> os.path.dirname(paths)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>fileList <span class="op">=</span> os.path.splitext(os.path.basename(paths))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>suffix <span class="op">=</span> <span class="st">'clean'</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>graph.toGFA(<span class="ss">f'</span><span class="sc">{</span>dirpath<span class="sc">}{</span>os<span class="sc">.</span>path<span class="sc">.</span>sep<span class="sc">}{</span>fileList[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>suffix<span class="sc">}{</span>fileList[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inverting-necessary-nodes" class="level2">
<h2 class="anchored" data-anchor-id="inverting-necessary-nodes">Inverting necessary nodes</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> invertNode(nodeID,graph,pathNodeArray):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    pathIDs,positions <span class="op">=</span> np.where(pathNodeArray<span class="op">==</span>nodeID<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    strandreversal <span class="op">=</span> {<span class="st">'+'</span>:<span class="st">'-'</span>,<span class="st">'-'</span>:<span class="st">'+'</span>}</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pathID,pos <span class="kw">in</span> <span class="bu">zip</span>(pathIDs,positions):</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>        nodeStrand <span class="op">=</span> graph.paths[pathID][pos]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>        graph.paths[pathID][pos] <span class="op">=</span> nodeStrand[:<span class="op">-</span><span class="dv">1</span>]<span class="op">+</span>strandreversal[nodeStrand[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    nodeFromLink <span class="op">=</span> graph.forwardLinks.get(nodeID<span class="op">+</span><span class="dv">1</span>,{})</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    positiveStrand <span class="op">=</span> nodeFromLink.get(<span class="st">'+'</span>,[])</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    negativeStrand <span class="op">=</span> nodeFromLink.get(<span class="st">'-'</span>,[])</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(positiveStrand)<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>        graph.forwardLinks[nodeID<span class="op">+</span><span class="dv">1</span>][<span class="st">'-'</span>] <span class="op">=</span> positiveStrand</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(negativeStrand)<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">del</span> graph.forwardLinks[nodeID<span class="op">+</span><span class="dv">1</span>][<span class="st">'-'</span>]</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(negativeStrand)<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>        graph.forwardLinks[nodeID<span class="op">+</span><span class="dv">1</span>][<span class="st">'+'</span>] <span class="op">=</span> negativeStrand</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(positiveStrand)<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>            <span class="kw">del</span> graph.forwardLinks[nodeID<span class="op">+</span><span class="dv">1</span>][<span class="st">'+'</span>]</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    revertLinks <span class="op">=</span> graph._revertLinks(graph.forwardLinks)        </span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>    nodeToLink <span class="op">=</span> revertLinks.get(nodeID<span class="op">+</span><span class="dv">1</span>,{})</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    positiveStrand <span class="op">=</span> nodeToLink.get(<span class="st">'+'</span>,[])</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    negativeStrand <span class="op">=</span> nodeToLink.get(<span class="st">'-'</span>,[])</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> fromNode,fromStrand <span class="kw">in</span> positiveStrand:</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>        graph.forwardLinks[fromNode][fromStrand].remove((nodeID<span class="op">+</span><span class="dv">1</span>,<span class="st">'+'</span>))</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>        graph.forwardLinks[fromNode][fromStrand].append((nodeID<span class="op">+</span><span class="dv">1</span>,<span class="st">'-'</span>))</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> fromNode,fromStrand <span class="kw">in</span> negativeStrand:</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>        graph.forwardLinks[fromNode][fromStrand].remove((nodeID<span class="op">+</span><span class="dv">1</span>,<span class="st">'-'</span>))</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>        graph.forwardLinks[fromNode][fromStrand].append((nodeID<span class="op">+</span><span class="dv">1</span>,<span class="st">'+'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>nodeLengths <span class="op">=</span> calcNodeLengths(graph)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>pathLengths,pathNodeArray,pathNodeLengths,pathDirArray,pathNodeLengthsCum <span class="op">=</span> initialPathAnalysis(graph,nodeLengths)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> nodeID <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(graph.nodes)):</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> graph.nodeStrandPaths[nodeID][<span class="dv">1</span>]<span class="op">&gt;</span>graph.nodeStrandPaths[nodeID][<span class="dv">0</span>]:</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Node </span><span class="sc">{</span>nodeID<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> inverted'</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>        invertNode(nodeID,graph,pathNodeArray)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>graph._pathCount()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths</code></pre>
</div>
</div>
</section>
<section id="removing-overlaps" class="level2">
<h2 class="anchored" data-anchor-id="removing-overlaps">Removing overlaps</h2>
<section id="removing-nodes-functionality" class="level3">
<h3 class="anchored" data-anchor-id="removing-nodes-functionality">Removing nodes functionality</h3>
</section>
<section id="finding-and-clearing-overlaps" class="level3">
<h3 class="anchored" data-anchor-id="finding-and-clearing-overlaps">Finding and clearing overlaps</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>graph.treeSort()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
0 - 0 - 1 - 1 - 2
0 - 1 - 2 - 2 - 3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>revertLinks <span class="op">=</span> graph._revertLinks(graph.forwardLinks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do we need it here or when we are going to remove nodes?</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>nodeLengths <span class="op">=</span> calcNodeLengths(graph)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>pathLengths,pathNodeArray,pathNodeLengths,pathDirArray,pathNodeLengthsCum <span class="op">=</span> initialPathAnalysis(graph,nodeLengths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>kmerOverlap <span class="op">=</span> <span class="dv">30</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>nodeIDsToRemove <span class="op">=</span> []</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>leftCut <span class="op">=</span> {}</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>rightCut <span class="op">=</span> {}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>graph.nodes,graph.nodeNameToID,graph.forwardLinks,revertLinks,nodeLengths,graph.order</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(['2887', '4954', '3502'],
 {'2887': 1, '4954': 2, '3502': 3},
 {1: {'+': [(2, '+')]}, 2: {'+': [(2, '+'), (3, '+')]}},
 {2: {'+': [(1, '+'), (2, '+')]}, 3: {'+': [(2, '+')]}},
 [3000, 3000, 3000],
 [1, 2, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> linkBounce(fromNodeStart,fromStrandStart,forwardLinks,revertLinks,nodeLengths,kmerOverlap,cutOffsetRight,leftCut,rightCut):</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    cutOffsetLeft <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    leftToCut <span class="op">=</span> [(fromNodeStart,fromStrandStart)]</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    rightToCut <span class="op">=</span> []</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    leftToProcess <span class="op">=</span> [(fromNodeStart,fromStrandStart)]</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    rightToProcess <span class="op">=</span> []</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     pdb.set_trace()</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (<span class="bu">len</span>(leftToProcess)<span class="op">&gt;</span><span class="dv">0</span> <span class="kw">or</span> <span class="bu">len</span>(rightToProcess)<span class="op">&gt;</span><span class="dv">0</span>):</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> node,strand <span class="kw">in</span> leftToProcess:</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>            rightSide <span class="op">=</span> graph.forwardLinks.get(node,{}).get(strand,[])</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> toNode,toStrand <span class="kw">in</span> rightSide:</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> toStrand<span class="op">==</span><span class="st">'+'</span>:</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>                    cutOffsetLeft <span class="op">=</span> <span class="bu">max</span>(leftCut.get(toNode,<span class="dv">0</span>),cutOffsetLeft)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>                    cutOffsetLeft <span class="op">=</span> <span class="bu">max</span>(rightCut.get(toNode,<span class="dv">0</span>),cutOffsetLeft)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> cutOffsetLeft<span class="op">&lt;</span>kmerOverlap<span class="op">-</span>cutOffsetRight <span class="kw">and</span> (toNode,toStrand) <span class="kw">not</span> <span class="kw">in</span> rightToCut <span class="kw">and</span> nodeLengths[toNode<span class="op">-</span><span class="dv">1</span>]<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>                    rightToCut.append((toNode,toStrand))</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>                    rightToProcess.append((toNode,toStrand))</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>        leftToProcess <span class="op">=</span> []</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> node,strand <span class="kw">in</span> rightToProcess:</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>            leftSide <span class="op">=</span> revertLinks.get(node,{}).get(strand,[])</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> fromNode,fromStrand <span class="kw">in</span> leftSide:</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> fromStrand<span class="op">==</span><span class="st">'+'</span>:</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>                    cutOffsetRight <span class="op">=</span> <span class="bu">max</span>(rightCut.get(fromNode,<span class="dv">0</span>),cutOffsetRight)</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>                    cutOffsetRight <span class="op">=</span> <span class="bu">max</span>(leftCut.get(fromNode,<span class="dv">0</span>),cutOffsetRight)</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> cutOffsetRight<span class="op">&lt;</span>kmerOverlap<span class="op">-</span>cutOffsetLeft <span class="kw">and</span> (fromNode,fromStrand) <span class="kw">not</span> <span class="kw">in</span> leftToCut <span class="kw">and</span> nodeLengths[fromNode<span class="op">-</span><span class="dv">1</span>]<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>                    leftToCut.append((fromNode,fromStrand))</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>                    leftToProcess.append((fromNode,fromStrand))</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>        rightToProcess <span class="op">=</span> []</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> leftToCut,rightToCut,cutOffsetLeft,cutOffsetRight</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> processBouncedLink(leftToCut,rightToCut,cutOffsetLeft,cutOffsetRight,graph,nodeLengths,leftCut,rightCut,):</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    toCut <span class="op">=</span> kmerOverlap <span class="op">-</span> cutOffsetLeft <span class="op">-</span> cutOffsetRight</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    minLengthRight <span class="op">=</span> <span class="bu">min</span>([nodeLengths[node<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> node,strand <span class="kw">in</span> rightToCut])</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    minLengthLeft <span class="op">=</span> <span class="bu">min</span>([nodeLengths[node<span class="op">-</span><span class="dv">1</span>] <span class="cf">for</span> node,strand <span class="kw">in</span> leftToCut])</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> minLengthRight<span class="op">&lt;</span>minLengthLeft:</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>        sideToCut <span class="op">=</span> rightToCut</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>        sideToKeep <span class="op">=</span> leftToCut</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>        globalPositiveSide <span class="op">=</span> leftCut</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>        globalNegativeSide <span class="op">=</span> rightCut</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>        side <span class="op">=</span> <span class="st">'right'</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>        sideToCut <span class="op">=</span> leftToCut</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>        sideToKeep <span class="op">=</span> rightToCut</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>        globalPositiveSide <span class="op">=</span> rightCut</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>        globalNegativeSide <span class="op">=</span> leftCut</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>        side <span class="op">=</span> <span class="st">'left'</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>    maxCutAdjustment <span class="op">=</span> <span class="bu">max</span>([<span class="bu">max</span>(toCut <span class="op">-</span> nodeLengths[node<span class="op">-</span><span class="dv">1</span>],<span class="dv">0</span>) <span class="cf">for</span> node,strand <span class="kw">in</span> sideToCut])</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node,strand <span class="kw">in</span> sideToCut:</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> strand<span class="op">==</span><span class="st">'+'</span>:</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> side <span class="op">==</span><span class="st">'right'</span>:</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>                graph.nodesData[node<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> graph.nodesData[node<span class="op">-</span><span class="dv">1</span>][toCut<span class="op">-</span>maxCutAdjustment:]</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>                graph.nodesData[node<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> graph.nodesData[node<span class="op">-</span><span class="dv">1</span>][:<span class="op">-</span>(toCut<span class="op">-</span>maxCutAdjustment)]</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>            globalPositiveSide[node] <span class="op">=</span> globalPositiveSide.get(node,<span class="dv">0</span>) <span class="op">+</span> toCut <span class="op">-</span> maxCutAdjustment</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> side <span class="op">==</span><span class="st">'left'</span>:</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>                graph.nodesData[node<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> graph.nodesData[node<span class="op">-</span><span class="dv">1</span>][toCut<span class="op">-</span>maxCutAdjustment:]</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>                graph.nodesData[node<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> graph.nodesData[node<span class="op">-</span><span class="dv">1</span>][:<span class="op">-</span>(toCut<span class="op">-</span>maxCutAdjustment)]</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>            globalNegativeSide[node] <span class="op">=</span> globalNegativeSide.get(node,<span class="dv">0</span>) <span class="op">+</span> toCut <span class="op">-</span> maxCutAdjustment</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>        nodeLengths[node<span class="op">-</span><span class="dv">1</span>] <span class="op">-=</span> toCut <span class="op">-</span> maxCutAdjustment</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> maxCutAdjustment<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># adjust the other side as well.</span></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> node,strand <span class="kw">in</span> sideToKeep:</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> strand<span class="op">==</span><span class="st">'+'</span>:</span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> side <span class="op">==</span><span class="st">'right'</span>:</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>                    graph.nodesData[node<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> graph.nodesData[node<span class="op">-</span><span class="dv">1</span>][:<span class="op">-</span>(maxCutAdjustment)]</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>                    graph.nodesData[node<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> graph.nodesData[node<span class="op">-</span><span class="dv">1</span>][maxCutAdjustment:]</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>                globalNegativeSide[node] <span class="op">=</span> globalNegativeSide.get(node,<span class="dv">0</span>) <span class="op">+</span> maxCutAdjustment</span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> side <span class="op">==</span><span class="st">'left'</span>:</span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>                    graph.nodesData[node<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> graph.nodesData[node<span class="op">-</span><span class="dv">1</span>][:<span class="op">-</span>(maxCutAdjustment)]</span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>                    graph.nodesData[node<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> graph.nodesData[node<span class="op">-</span><span class="dv">1</span>][maxCutAdjustment:]</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>                globalPositiveSide[node] <span class="op">=</span> globalPositiveSide.get(node,<span class="dv">0</span>) <span class="op">+</span> maxCutAdjustment</span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a>            nodeLengths[node<span class="op">-</span><span class="dv">1</span>] <span class="op">-=</span> maxCutAdjustment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> fromNodeStart <span class="kw">in</span> graph.order:</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'------'</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Procesing node </span><span class="sc">{</span>fromNodeStart<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> fromNodeStart <span class="kw">not</span> <span class="kw">in</span> graph.forwardLinks:</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'No links originates from node </span><span class="sc">{</span>fromNodeStart<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    cutOffsetRight <span class="op">=</span> rightCut.get(fromNodeStart,<span class="dv">0</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    cutOffsetLeft <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cutOffsetRight<span class="op">&lt;</span>kmerOverlap <span class="kw">and</span> <span class="st">'+'</span> <span class="kw">in</span> graph.forwardLinks[fromNodeStart] <span class="kw">and</span> nodeLengths[fromNodeStart<span class="op">-</span><span class="dv">1</span>]<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>        leftToCut,rightToCut,cutOffsetLeft,cutOffsetRight <span class="op">=</span> linkBounce(fromNodeStart,<span class="st">'+'</span>,graph.forwardLinks,revertLinks,nodeLengths,kmerOverlap,cutOffsetRight,leftCut,rightCut)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Processing positive "+" strand of node </span><span class="sc">{</span>fromNodeStart<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'leftToCut'</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(leftToCut)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'rightToCut'</span>)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(rightToCut)</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'cutOffsetLeft: </span><span class="sc">{</span>cutOffsetLeft<span class="sc">}</span><span class="ss">; cutOffsetRight: </span><span class="sc">{</span>cutOffsetRight<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>        processBouncedLink(leftToCut,rightToCut,cutOffsetLeft,cutOffsetRight,graph,nodeLengths,leftCut,rightCut,)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'leftCut'</span>)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(leftCut)</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'rightCut'</span>)</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(rightCut)</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    cutOffsetRight <span class="op">=</span> leftCut.get(fromNodeStart,<span class="dv">0</span>)</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cutOffsetRight<span class="op">&lt;</span>kmerOverlap <span class="kw">and</span> <span class="st">'-'</span> <span class="kw">in</span> graph.forwardLinks[fromNodeStart] <span class="kw">and</span> nodeLengths[fromNodeStart<span class="op">-</span><span class="dv">1</span>]<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>        leftToCut,rightToCut,cutOffsetLeft,cutOffsetRight <span class="op">=</span> linkBounce(fromNodeStart,<span class="st">'-'</span>,graph.forwardLinks,revertLinks,nodeLengths,kmerOverlap,cutOffsetRight,leftCut,rightCut)</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Processing positive "-" strand of node </span><span class="sc">{</span>fromNodeStart<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'leftToCut'</span>)</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(leftToCut)</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'rightToCut'</span>)</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(rightToCut)</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'cutOffsetLeft: </span><span class="sc">{</span>cutOffsetLeft<span class="sc">}</span><span class="ss">; cutOffsetRight: </span><span class="sc">{</span>cutOffsetRight<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>        processBouncedLink(leftToCut,rightToCut,cutOffsetLeft,cutOffsetRight,graph,nodeLengths,leftCut,rightCut,)</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'leftCut'</span>)</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(leftCut)</span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'rightCut'</span>)</span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(rightCut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>------
Procesing node 1
Processing positive "+" strand of node 1
leftToCut
[(1, '+')]
rightToCut
[(4, '+'), (2, '+')]
cutOffsetLeft: 0; cutOffsetRight: 0
leftCut
{4: 30, 2: 30}
rightCut
{}
------
Procesing node 4
Processing positive "+" strand of node 4
leftToCut
[(4, '+')]
rightToCut
[(3, '+')]
cutOffsetLeft: 0; cutOffsetRight: 0
leftCut
{4: 30, 2: 30, 3: 1}
rightCut
{4: 29}
------
Procesing node 2
Processing positive "+" strand of node 2
leftToCut
[(2, '+')]
rightToCut
[(3, '-')]
cutOffsetLeft: 0; cutOffsetRight: 0
leftCut
{4: 30, 2: 30, 3: 1}
rightCut
{4: 29, 2: 29, 3: 1}
------
Procesing node 3
Processing positive "+" strand of node 3
leftToCut
[(3, '+')]
rightToCut
[(7, '+')]
cutOffsetLeft: 0; cutOffsetRight: 1
leftCut
{4: 30, 2: 30, 3: 1, 7: 29}
rightCut
{4: 29, 2: 29, 3: 1}
Processing positive "-" strand of node 3
leftToCut
[(3, '-')]
rightToCut
[(5, '+')]
cutOffsetLeft: 0; cutOffsetRight: 1
leftCut
{4: 30, 2: 30, 3: 1, 7: 29, 5: 29}
rightCut
{4: 29, 2: 29, 3: 1}
------
Procesing node 7
Processing positive "+" strand of node 7
leftToCut
[(7, '+'), (5, '+')]
rightToCut
[(6, '+')]
cutOffsetLeft: 0; cutOffsetRight: 0
leftCut
{4: 30, 2: 30, 3: 1, 7: 29, 5: 29}
rightCut
{4: 29, 2: 29, 3: 1, 7: 30, 5: 30}
------
Procesing node 5
------
Procesing node 6
No links originates from node 6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>nodeIDsToRemove <span class="op">=</span> [i <span class="cf">for</span> i,l <span class="kw">in</span> <span class="bu">enumerate</span>(nodeLengths) <span class="cf">if</span> l<span class="op">==</span><span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>leftCut,rightCut,graph.forwardLinks,nodeLengths,nodeIDsToRemove</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>({4: 30, 2: 30, 3: 1, 7: 29, 5: 29},
 {4: 29, 2: 29, 3: 1, 7: 30, 5: 30},
 {1: {'+': [(4, '+'), (2, '+')]},
  2: {'+': [(3, '-')]},
  3: {'-': [(5, '+')], '+': [(7, '+')]},
  4: {'+': [(3, '+')]},
  5: {'+': [(6, '+')]},
  7: {'+': [(6, '+')]}},
 [3000, 0, 3000, 0, 0, 3000, 0],
 [1, 3, 4, 6])</code></pre>
</div>
</div>
</section>
<section id="removing-empty-nodes" class="level3">
<h3 class="anchored" data-anchor-id="removing-empty-nodes">Removing empty nodes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> removePositionsFromPaths(graph,pathIDs,positions):</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    offsetList <span class="op">=</span> np.zeros(<span class="bu">len</span>(graph.paths),dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pathID,pos <span class="kw">in</span> <span class="bu">zip</span>(pathIDs,positions):</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> graph.paths[pathID][pos<span class="op">-</span>offsetList[pathID]]</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        offsetList[pathID] <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> updateLinkList(strandList,offsetDict):</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    newStrand <span class="op">=</span> []</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> toNode,toStrand <span class="kw">in</span> strandList:</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>        newStrand.append((offsetDict[toNode<span class="op">-</span><span class="dv">1</span>]<span class="op">+</span><span class="dv">1</span>,toStrand))</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> newStrand</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clearNodes(graph,nodeIDs):</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    offsetDict <span class="op">=</span> {node:node <span class="cf">for</span> node <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(graph.nodes))}</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> nodeID <span class="kw">in</span> nodeIDs:</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>        updatedNodeID <span class="op">=</span> offsetDict[nodeID]</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>        nodeName <span class="op">=</span> graph.nodes[updatedNodeID]</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> graph.nodeNameToID[nodeName]</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> graph.nodes[updatedNodeID]</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> graph.nodesData[updatedNodeID]</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> offsetDict[nodeID]</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>        offsetDict.update({k:v<span class="op">-</span><span class="dv">1</span> <span class="cf">for</span> k,v <span class="kw">in</span> offsetDict.items() <span class="cf">if</span> k<span class="op">&gt;</span>nodeID})</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    graph.nodeNameToID.update({k:offsetDict[v<span class="op">-</span><span class="dv">1</span>]<span class="op">+</span><span class="dv">1</span> <span class="cf">for</span> k,v <span class="kw">in</span> graph.nodeNameToID.items()})</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pathID <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(graph.paths)):</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>        graph.paths[pathID] <span class="op">=</span> [<span class="ss">f'</span><span class="sc">{</span>offsetDict[<span class="bu">int</span>(el[:<span class="op">-</span><span class="dv">1</span>])<span class="op">-</span><span class="dv">1</span>]<span class="op">+</span><span class="dv">1</span><span class="sc">}{</span>el[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> el <span class="kw">in</span> graph.paths[pathID]]</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    nodesInForwardLinks <span class="op">=</span> <span class="bu">list</span>(graph.forwardLinks.keys())</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node <span class="kw">in</span> nodesInForwardLinks:</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>        nodeDict <span class="op">=</span> graph.forwardLinks[node]</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>        newNode <span class="op">=</span> offsetDict[node<span class="op">-</span><span class="dv">1</span>]<span class="op">+</span><span class="dv">1</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node<span class="op">!=</span>newNode:</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">del</span> graph.forwardLinks[node]</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>        forwardStrand <span class="op">=</span> updateLinkList(nodeDict.get(<span class="st">'+'</span>,[]),offsetDict)</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>        inverseStrand <span class="op">=</span> updateLinkList(nodeDict.get(<span class="st">'-'</span>,[]),offsetDict)</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(forwardStrand)<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>            graph.forwardLinks.setdefault(newNode,{})[<span class="st">'+'</span>] <span class="op">=</span> forwardStrand</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(inverseStrand)<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>            graph.forwardLinks.setdefault(newNode,{})[<span class="st">'-'</span>] <span class="op">=</span> inverseStrand</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> removeNode(nodeID,graph,revertLinks,pathNodeArray):</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    pathIDs,positions <span class="op">=</span> np.where(pathNodeArray<span class="op">==</span>nodeID<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     pdb.set_trace()</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    excludeTuples <span class="op">=</span> [(nodeID<span class="op">+</span><span class="dv">1</span>,<span class="st">'+'</span>),(nodeID<span class="op">+</span><span class="dv">1</span>,<span class="st">'-'</span>)]</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    nodeToLink <span class="op">=</span> revertLinks.get(nodeID<span class="op">+</span><span class="dv">1</span>,{})</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    toPositiveStrand <span class="op">=</span> nodeToLink.get(<span class="st">'+'</span>,[])</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    toNegativeStrand <span class="op">=</span> nodeToLink.get(<span class="st">'-'</span>,[])</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    nodeFromLink <span class="op">=</span> graph.forwardLinks.get(nodeID<span class="op">+</span><span class="dv">1</span>,{})</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    fromPositiveStrand <span class="op">=</span> nodeFromLink.get(<span class="st">'+'</span>,[])</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    fromNegativeStrand <span class="op">=</span> nodeFromLink.get(<span class="st">'-'</span>,[])</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> fromNode,fromStrand <span class="kw">in</span> toPositiveStrand:</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Amending forwardLinks for positive strand of current node</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>        forwardNodeStrand <span class="op">=</span> graph.forwardLinks.get(fromNode,{}).get(fromStrand,[])</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>        forwardNodeStrand <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(forwardNodeStrand).union(fromPositiveStrand).difference(excludeTuples))</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>        graph.forwardLinks[fromNode][fromStrand] <span class="op">=</span> forwardNodeStrand</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> fromNode,fromStrand <span class="kw">in</span> toNegativeStrand:</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Amend forwardLinks for negative strand of current node</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>        forwardNodeStrand <span class="op">=</span> graph.forwardLinks.get(fromNode,{}).get(fromStrand,[])</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>        forwardNodeStrand <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(forwardNodeStrand).union(fromNegativeStrand).difference(excludeTuples))</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>        graph.forwardLinks[fromNode][fromStrand] <span class="op">=</span> forwardNodeStrand</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> toNode,toStrand <span class="kw">in</span> fromPositiveStrand:</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Amending revertLinks for positive strand of current node</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>        revertNodeStrand <span class="op">=</span> revertLinks.get(toNode,{}).get(toStrand,[])</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>        revertNodeStrand <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(revertNodeStrand).union(toPositiveStrand).difference(excludeTuples))</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>        revertLinks[toNode][toStrand] <span class="op">=</span> revertNodeStrand</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> toNode,toStrand <span class="kw">in</span> fromNegativeStrand:</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Amend revertLinks for negative strand of current node</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>        revertNodeStrand <span class="op">=</span> revertLinks.get(toNode,{}).get(toStrand,[])</span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>        revertNodeStrand <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(revertNodeStrand).union(toNegativeStrand).difference(excludeTuples))</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>        revertLinks[toNode][toStrand] <span class="op">=</span> revertNodeStrand</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> revertLinks[nodeID<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> graph.forwardLinks[nodeID<span class="op">+</span><span class="dv">1</span>]</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pathIDs,positions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _removeNodes(<span class="va">self</span>,nodeIDsToRemove)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># That is how deleting of nodes should happen.</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    pathIDs <span class="op">=</span> []</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    positions <span class="op">=</span> []</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> nodeID <span class="kw">in</span> nodeIDsToRemove:</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>        pID,pos <span class="op">=</span> removeNode(nodeID,<span class="va">self</span>,revertLinks,pathNodeArray)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>        pathIDs.extend(pID)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>        positions.extend(pos)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    removePositionsFromPaths(<span class="va">self</span>,pathIDs,positions)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    clearNodes(<span class="va">self</span>,nodeIDsToRemove)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>._pathCount()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>graph.treeSort()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Constructing Tremaux tree
Done!
Getting root nodes
Start Loop...
0 - 0 - 1 - 1 - 2
0 - 1 - 2 - 2 - 3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Do we need it here or when we are going to remove nodes?</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>nodeLengths <span class="op">=</span> calcNodeLengths(graph)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>pathLengths,pathNodeArray,pathNodeLengths,pathDirArray,pathNodeLengthsCum <span class="op">=</span> initialPathAnalysis(graph,nodeLengths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Calculating nodes length...
Processing node 3/3
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>graph.nodes,graph.nodeNameToID,graph.forwardLinks,revertLinks,nodeLengths,graph.order</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(['1612', '1087', '2264'],
 {'1612': 1, '1087': 2, '2264': 3},
 {1: {'+': [(2, '-'), (2, '+')]}, 2: {'+': [(3, '+')], '-': [(3, '+')]}},
 {3: {'-': [(1, '+')], '+': [(1, '+')]}, 6: {'+': [(3, '-'), (3, '+')]}},
 [3000, 3000, 3000],
 [1, 2, 3])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>graph.nodes,graph.nodeNameToID,graph.forwardLinks,revertLinks,nodeLengths,graph.order</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(['1612', '1087', '2264'],
 {'1612': 1, '1087': 2, '2264': 3},
 {1: {'+': [(2, '-'), (2, '+')]}, 2: {'+': [(3, '+')], '-': [(3, '+')]}},
 {3: {'-': [(1, '+')], '+': [(1, '+')]}, 6: {'+': [(3, '-'), (3, '+')]}},
 [3000, 3000, 3000],
 [1, 2, 3])</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>