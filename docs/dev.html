<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>pygengraph - Development notebook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="pygengraph - Development notebook">
<meta property="og:description" content="https://jakevdp.github.io/PythonDataScienceHandbook/01.07-timing-and-profiling.html">
<meta property="og:site-name" content="pygengraph">
<meta name="twitter:title" content="pygengraph - Development notebook">
<meta name="twitter:description" content="https://jakevdp.github.io/PythonDataScienceHandbook/01.07-timing-and-profiling.html">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">pygengraph</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Development notebook</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">pygengraph</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./init.html" class="sidebar-item-text sidebar-link">Synteny module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./graph.html" class="sidebar-item-text sidebar-link">Graph module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tree.html" class="sidebar-item-text sidebar-link">Tree module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./synteny.html" class="sidebar-item-text sidebar-link">Synteny module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">Utils module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./export.html" class="sidebar-item-text sidebar-link">Export module</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./scripts.html" class="sidebar-item-text sidebar-link">Script module</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">docs</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  docs/index.html
  </li>
          <li class="sidebar-item">
  docs/CONTRIBUTING.html
  </li>
          <li class="sidebar-item">
  docs/debruijngraphprocessing.html
  </li>
          <li class="sidebar-item">
  docs/dev.html
  </li>
          <li class="sidebar-item">
  docs/export.html
  </li>
          <li class="sidebar-item">
  docs/graph.html
  </li>
          <li class="sidebar-item">
  docs/init.html
  </li>
          <li class="sidebar-item">
  docs/scripts.html
  </li>
          <li class="sidebar-item">
  docs/synteny.html
  </li>
          <li class="sidebar-item">
  docs/tree.html
  </li>
          <li class="sidebar-item">
  docs/utils.html
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#code-profiling-help" id="toc-code-profiling-help" class="nav-link active" data-scroll-target="#code-profiling-help">code profiling help</a></li>
  <li><a href="#processing-new-annotations" id="toc-processing-new-annotations" class="nav-link" data-scroll-target="#processing-new-annotations">Processing new annotations</a></li>
  <li><a href="#playing-with-graphs" id="toc-playing-with-graphs" class="nav-link" data-scroll-target="#playing-with-graphs">Playing with graphs</a></li>
  <li><a href="#converting-path-files-to-graphs" id="toc-converting-path-files-to-graphs" class="nav-link" data-scroll-target="#converting-path-files-to-graphs">Converting path files to graphs</a></li>
  <li><a href="#developingtesting-new-processing-methods" id="toc-developingtesting-new-processing-methods" class="nav-link" data-scroll-target="#developingtesting-new-processing-methods">Developing/Testing new processing methods</a>
  <ul class="collapse">
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a>
  <ul class="collapse">
  <li><a href="#convert-genomegraph-to" id="toc-convert-genomegraph-to" class="nav-link" data-scroll-target="#convert-genomegraph-to">Convert GenomeGraph to</a></li>
  <li><a href="#block-processing" id="toc-block-processing" class="nav-link" data-scroll-target="#block-processing">Block processing</a></li>
  <li><a href="#link-processing" id="toc-link-processing" class="nav-link" data-scroll-target="#link-processing">Link processing</a></li>
  <li><a href="#rearrangement-blocks" id="toc-rearrangement-blocks" class="nav-link" data-scroll-target="#rearrangement-blocks">Rearrangement blocks</a></li>
  <li><a href="#wrapper" id="toc-wrapper" class="nav-link" data-scroll-target="#wrapper">Wrapper</a></li>
  </ul></li>
  <li><a href="#running" id="toc-running" class="nav-link" data-scroll-target="#running">Running</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-git"></i></div><div class="action-links"><p><a href="https://gitlab.com/pigrenok/pygengraph/tree/master/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Development notebook</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pdb</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygengraph.graph <span class="im">import</span> GenomeGraph</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygengraph.graph <span class="im">import</span> initialPathAnalysis,calcNodeLengths,getNodesStructurePathNodeInversionRate,pathNodeDirToCombinedArray,getNextNodePath</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygengraph.graph <span class="im">import</span> convertPathsToGraph</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nbdev <span class="im">import</span> nbdev_export</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>nbdev_export()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="code-profiling-help" class="level3">
<h3 class="anchored" data-anchor-id="code-profiling-help">code profiling help</h3>
<p>https://jakevdp.github.io/PythonDataScienceHandbook/01.07-timing-and-profiling.html</p>
<p><code>%time</code>: Time the execution of a single statement<br>
<code>%timeit</code>: Time repeated execution of a single statement for more accuracy<br>
<code>%prun</code>: Run code with the profiler<br>
<code>%lprun</code>: Run code with the line-by-line profiler<br>
<code>%memit</code>: Measure the memory use of a single statement<br>
<code>%mprun</code>: Run code with the line-by-line memory profiler</p>
</section>
<section id="processing-new-annotations" class="level1">
<h1>Processing new annotations</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skbio <span class="im">import</span> read <span class="im">as</span> bioread</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skbio.metadata <span class="im">import</span> IntervalMetadata <span class="co"># Is it really needed?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>testpath <span class="op">=</span> <span class="st">'../../1001G/annotations/freeze2.1/'</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>testann <span class="op">=</span> <span class="st">'1741.gff'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>testannotation <span class="op">=</span> bioread(<span class="ss">f'</span><span class="sc">{</span>testpath<span class="sc">}{</span>testann<span class="sc">}</span><span class="ss">'</span>,<span class="bu">format</span><span class="op">=</span><span class="st">'gff3'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.8/dist-packages/skbio/io/registry.py:547: FormatIdentificationWarning: &lt;_io.BufferedReader name='../../1001G/annotations/freeze2.1/1741.gff'&gt; does not look like a gff3 file
  warn("%r does not look like a %s file"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tseqID,tseqAnn <span class="op">=</span> <span class="bu">next</span>(testannotation)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>tseqID</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'1741_Chr4'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>tseqAnn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>51330 interval features
-----------------------
Interval(interval_metadata=&lt;140458907721248&gt;, bounds=[(6129, 6387)], fuzzy=[(False, False)], metadata={'source': 'EVM', 'type': 'gene', 'score': '.', 'strand': '+', 'ID': 'evm.TU.1741_Chr4.1', 'Name': 'EVM%20prediction%201741_Chr4.1', 'OG': 'OG0000013', 'AT': 'AT1G33860'})
Interval(interval_metadata=&lt;140458907721248&gt;, bounds=[(6129, 6387)], fuzzy=[(False, False)], metadata={'source': 'EVM', 'type': 'mRNA', 'score': '.', 'strand': '+', 'ID': 'evm.model.1741_Chr4.1', 'Parent': 'evm.TU.1741_Chr4.1', 'Name': 'EVM%20prediction%201741_Chr4.1'})
...
Interval(interval_metadata=&lt;140458907721248&gt;, bounds=[(19040175, 19040364)], fuzzy=[(False, False)], metadata={'source': 'EVM', 'type': 'exon', 'score': '.', 'strand': '+', 'ID': 'evm.model.1741_Chr4.3942.exon4', 'Parent': 'evm.model.1741_Chr4.3942'})
Interval(interval_metadata=&lt;140458907721248&gt;, bounds=[(19040175, 19040364)], fuzzy=[(False, False)], metadata={'source': 'EVM', 'type': 'CDS', 'score': '.', 'strand': '+', 'phase': 0, 'ID': 'cds.evm.model.1741_Chr4.3942', 'Parent': 'evm.model.1741_Chr4.3942'})</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>il <span class="op">=</span> <span class="bu">list</span>(tseqAnn.query(metadata<span class="op">=</span>{}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>interval <span class="op">=</span> il[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> IntervalMetadata(<span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>im.merge(tseqAnn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>im</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>51330 interval features
-----------------------
Interval(interval_metadata=&lt;140458895764400&gt;, bounds=[(6129, 6387)], fuzzy=[(False, False)], metadata={'source': 'EVM', 'type': 'gene', 'score': '.', 'strand': '+', 'ID': 'evm.TU.1741_Chr4.1', 'Name': 'EVM%20prediction%201741_Chr4.1', 'OG': 'OG0000013', 'AT': 'AT1G33860'})
Interval(interval_metadata=&lt;140458895764400&gt;, bounds=[(6129, 6387)], fuzzy=[(False, False)], metadata={'source': 'EVM', 'type': 'mRNA', 'score': '.', 'strand': '+', 'ID': 'evm.model.1741_Chr4.1', 'Parent': 'evm.TU.1741_Chr4.1', 'Name': 'EVM%20prediction%201741_Chr4.1'})
...
Interval(interval_metadata=&lt;140458895764400&gt;, bounds=[(19040175, 19040364)], fuzzy=[(False, False)], metadata={'source': 'EVM', 'type': 'exon', 'score': '.', 'strand': '+', 'ID': 'evm.model.1741_Chr4.3942.exon4', 'Parent': 'evm.model.1741_Chr4.3942'})
Interval(interval_metadata=&lt;140458895764400&gt;, bounds=[(19040175, 19040364)], fuzzy=[(False, False)], metadata={'source': 'EVM', 'type': 'CDS', 'score': '.', 'strand': '+', 'phase': 0, 'ID': 'cds.evm.model.1741_Chr4.3942', 'Parent': 'evm.model.1741_Chr4.3942'})</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="st">'../../1001G/annotations/Anna/'</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>chromosome <span class="op">=</span> <span class="st">'chr_1'</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>pangenFile <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>chromosome<span class="sc">}</span><span class="ss">_panden_v03.gff'</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>simgrFile <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>chromosome<span class="sc">}</span><span class="ss">_simgr_te_v03.gff'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>annotation <span class="op">=</span> bioread(<span class="ss">f'</span><span class="sc">{</span>path<span class="sc">}{</span>simgrFile<span class="sc">}</span><span class="ss">'</span>,<span class="bu">format</span><span class="op">=</span><span class="st">'gff3'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/lib/python3.8/dist-packages/skbio/io/registry.py:547: FormatIdentificationWarning: &lt;_io.BufferedReader name='../../1001G/annotations/Anna/chr_1_simgr_te_v03.gff'&gt; does not look like a gff3 file
  warn("%r does not look like a %s file"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>annDict <span class="op">=</span> {}</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> seqid,intList <span class="kw">in</span> annotation:</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    annDict.setdefault(seqid,IntervalMetadata(<span class="va">None</span>)).merge(intList)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>annDict.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>dict_keys(['10002_Chr1', '10015_Chr1', '10024_Chr1', '1741_Chr1', '220011_Chr1', '22002_Chr1', '22003_Chr1', '22004_Chr1', '22005_Chr1', '22006_Chr1', '22007_Chr1', '6024_Chr1', '6069_Chr1', '6124_Chr1', '6244_Chr1', '6909_Chr1', '6966_Chr1', '8236_Chr1', '9075_Chr1', '9537_Chr1', '9543_Chr1', '9638_Chr1', '9728_Chr1', '9764_Chr1', '9888_Chr1', '9905_Chr1', '9981_Chr1'])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>seqID,seqAnn <span class="op">=</span> <span class="bu">next</span>(annotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>seqID</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'10002_Chr1'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(seqAnn.query(metadata<span class="op">=</span>{}))[<span class="dv">0</span>].metadata.get(<span class="st">'AG'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> seqID,seqAnn <span class="kw">in</span> annotation:</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(seqID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="playing-with-graphs" class="level1">
<h1>Playing with graphs</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fileDir <span class="op">=</span> <span class="st">'../../1001G/GraphCollapsing/TestGraphs'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graph 1</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> [[<span class="st">'1+'</span>,<span class="st">'2+'</span>,<span class="st">'3+'</span>,<span class="st">'4+'</span>,<span class="st">'5+'</span>,<span class="st">'6+'</span>],[<span class="st">'1+'</span>,<span class="st">'4-'</span>,<span class="st">'3-'</span>,<span class="st">'2-'</span>,<span class="st">'5+'</span>,<span class="st">'6+'</span>],[<span class="st">'1+'</span>,<span class="st">'2+'</span>,<span class="st">'3+'</span>,<span class="st">'5-'</span>,<span class="st">'4-'</span>,<span class="st">'6+'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graph 2</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>paths <span class="op">=</span> [[<span class="st">'1+'</span>, <span class="st">'2+'</span>, <span class="st">'3+'</span>, <span class="st">'4+'</span>, <span class="st">'5+'</span>],[<span class="st">'1+'</span>, <span class="st">'2+'</span>, <span class="st">'3+'</span>, <span class="st">'4+'</span>, <span class="st">'2+'</span>, <span class="st">'3+'</span>, <span class="st">'4+'</span>, <span class="st">'5+'</span>],[<span class="st">'1+'</span>, <span class="st">'2+'</span>, <span class="st">'3+'</span>, <span class="st">'4+'</span>, <span class="st">'2+'</span>, <span class="st">'3+'</span>, <span class="st">'4+'</span>, <span class="st">'5+'</span>],[<span class="st">'1+'</span>, <span class="st">'2+'</span>, <span class="st">'3+'</span>, <span class="st">'4+'</span>, <span class="st">'2+'</span>, <span class="st">'4+'</span>, <span class="st">'5+'</span>],[<span class="st">'1+'</span>, <span class="st">'2+'</span>, <span class="st">'4+'</span>, <span class="st">'2+'</span>, <span class="st">'3+'</span>, <span class="st">'4+'</span>, <span class="st">'5+'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pathsToEdgeList(pathList):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    edgeList <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> path <span class="kw">in</span> pathList:</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        edgeList.update(<span class="bu">zip</span>(path[:<span class="op">-</span><span class="dv">1</span>],path[<span class="dv">1</span>:]))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sorted</span>(<span class="bu">list</span>(edgeList),key<span class="op">=</span><span class="kw">lambda</span> t: t[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>edges <span class="op">=</span> pathsToEdgeList(paths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>numNodes <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>idealGraph <span class="op">=</span> nx.DiGraph()</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>igEdges <span class="op">=</span> [(<span class="bu">str</span>(i)<span class="op">+</span><span class="st">'+'</span>,<span class="bu">str</span>(i<span class="op">+</span><span class="dv">1</span>)<span class="op">+</span><span class="st">'+'</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,numNodes)]</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>idealGraph.add_edges_from(igEdges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>nGraph <span class="op">=</span> nx.DiGraph()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>nGraph.add_edges_from(edges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>nGraph.nodes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>NodeView(('1+', '4-', '2+', '3+', '2-', '5+', '5-', '4+', '3-', '6+'))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>nx.draw_networkx(nx.junction_tree(nGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="dev_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>q,w <span class="op">=</span> nx.summarization.dedensify(nGraph,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(q.edges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('1+', '2+'),
 ('2+', '3+'),
 ('2+', '4+'),
 ('3+', '4+'),
 ('4+', '5+'),
 ('4+', '2+')]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>nGraph.add_edge(<span class="st">'4+'</span>,<span class="st">'2+'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>nGraph.remove_edge(<span class="st">'4+'</span>,<span class="st">'2+'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(nx.algorithms.components.strongly_connected.strongly_connected_components(nGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'5+'}, {'2+', '3+', '4+'}, {'1+'}]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(nx.algorithms.simple_cycles(nGraph))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[['3+', '4+', '2+'], ['2+', '4+']]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>paths,cost <span class="op">=</span> nx.algorithms.optimal_edit_paths(nGraph,idealGraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(paths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>7</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>paths[<span class="dv">0</span>][<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[(('1+', '2+'), None),
 (('1+', '4-'), None),
 (('2+', '3+'), ('1+', '2+')),
 (('2-', '5+'), None),
 (('3+', '4+'), None),
 (('4+', '5+'), None),
 (('3+', '5-'), ('2+', '3+')),
 (('5-', '4-'), ('3+', '4+')),
 (('4-', '3-'), ('4+', '5+')),
 (('3-', '2-'), ('5+', '6+')),
 (('4-', '6+'), None),
 (('5+', '6+'), None)]</code></pre>
</div>
</div>
</section>
<section id="converting-path-files-to-graphs" class="level1">
<h1>Converting path files to graphs</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>convertPathsToGraph(<span class="st">'../../Meetings/1001G+_20220518/paths.txt'</span>,doSorting<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>reprocess <span class="op">=</span> <span class="va">False</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filepath <span class="kw">in</span> glob.glob(<span class="ss">f'</span><span class="sc">{</span>fileDir<span class="sc">}{</span>os<span class="sc">.</span>path<span class="sc">.</span>sep<span class="sc">}</span><span class="ss">*.txt'</span>):</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    filebase <span class="op">=</span> os.path.splitext(filepath)[<span class="dv">0</span>]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(<span class="ss">f'</span><span class="sc">{</span>filebase<span class="sc">}</span><span class="ss">.gfa'</span>) <span class="kw">or</span> reprocess:</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'processing </span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>basename(filebase)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>        convertPathsToGraph(filepath,doSorting<span class="op">=</span><span class="st">'nodesort'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>processing inversion_test_12
Calculating nodes length...
Processing node 8/8
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths

processing inversion_test_11
Calculating nodes length...
Processing node 8/8
Finished calculating nodes lengths
Preprocessing paths...
Processing path 2/2
Finished preprocessing paths
</code></pre>
</div>
</div>
</section>
<section id="developingtesting-new-processing-methods" class="level1">
<h1>Developing/Testing new processing methods</h1>
<section id="functions" class="level2">
<h2 class="anchored" data-anchor-id="functions">Functions</h2>
<ul>
<li>Convert GenomeGraph to NetworkX graph (When?)</li>
<li>Identify all + -&gt; - points (do we need to do the same for all valid - -&gt; + separately? No! It should be taken care inside inversion blocks, if any left unattended, then they should be precessed separately.)</li>
<li><ol start="16" type="a">
<li>Process each such point (do not forget that there can be several paths within onemajor block and all of them should be considered).</li>
</ol></li>
<li><ol start="16" type="a">
<li>isolate each reversible block and do the reversion (applied to the original graph or to NetworkX graph?)</li>
</ol>
<ul>
<li>Если при обходе инверсии номер узла увеличивается, то все между предыдущим (или первым) и нынешним добавляются в search terms. Если же номер узла уменьшается, то те номера между предыдущим и нынешним которые уже есть в поисковой группе убираются, а те, которых нет, добавляются.</li>
</ul></li>
<li>Identify loops</li>
<li><ol start="16" type="a">
<li>For each loop identify best link to break and remove it from the graph</li>
</ol></li>
<li><ol start="16" type="a">
<li>Identify type of loop and process it accordingly (real loops - recorded and processed, continuous virtual loops - link for pairing, non-continuous link - consider loop ending at the loop link end).</li>
</ol></li>
<li>Identify bubble ends</li>
<li><ol start="16" type="a">
<li>Process each bubble</li>
</ol></li>
<li>Record pairs and double pairs if any.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> identifyPotentialInvStarts(graph):</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Identify all + -&gt; - points or - nodes as start nodes in the graph.</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">    We do not need to do the same for all - -&gt; + separately. </span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">    It should be taken care inside inversion blocks, if any left unattended, </span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">    then they should be precessed separately.</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">    The function also identify all graph end nodes (the nodes which do not have any outgoing links)</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    graphEnds <span class="op">=</span> []</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    invStartPoints <span class="op">=</span> []</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> fromNode,nodeLinks <span class="kw">in</span> graph:</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(nodeLinks)<span class="op">==</span><span class="dv">0</span>:</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>            graphEnds.append(fromNode)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'-'</span> <span class="kw">in</span> nodeLinks:</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>            <span class="co"># The node is passed in inverted direction.</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>            incomingLinks <span class="op">=</span> graph.backLinks[fromNode][<span class="st">'-'</span>]</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(incomingLinks)<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>                <span class="co"># There are links coming towards the inverted version of the node.</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> incomingNode,incomingDir <span class="kw">in</span> incomingLinks:</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> incomingDir<span class="op">==</span><span class="st">'+'</span>:</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># If there is any edge coming to inverted node comes from positive node, then add it</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># to the list of potential inversion starts.</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>                        invStartPoints.append((incomingNode,fromNode))</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If there is a inverted node without incoming edge, then it is the start of at least one path</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>                <span class="co"># It should also be considered as the potential inverstion start</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>                invStartPoints.append(<span class="va">None</span>,fromNode)</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> invStartPoints,graphEnds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="convert-genomegraph-to" class="level3">
<h3 class="anchored" data-anchor-id="convert-genomegraph-to">Convert GenomeGraph to</h3>
</section>
<section id="block-processing" class="level3">
<h3 class="anchored" data-anchor-id="block-processing">Block processing</h3>
</section>
<section id="link-processing" class="level3">
<h3 class="anchored" data-anchor-id="link-processing">Link processing</h3>
</section>
<section id="rearrangement-blocks" class="level3">
<h3 class="anchored" data-anchor-id="rearrangement-blocks">Rearrangement blocks</h3>
</section>
<section id="wrapper" class="level3">
<h3 class="anchored" data-anchor-id="wrapper">Wrapper</h3>
</section>
</section>
<section id="running" class="level2">
<h2 class="anchored" data-anchor-id="running">Running</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>notebook2script()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Converted 00_init.ipynb.
Converted 01_graph.ipynb.
Converted 02_tree.ipynb.
Converted 03_synteny.ipynb.
Converted 04_utils.ipynb.
Converted 05_export.ipynb.
Converted 05_exportDev.ipynb.
Converted deBruijnGraphProcessing.ipynb.
Converted dev.ipynb.
Converted graphTesting.ipynb.
Converted index.ipynb.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span>(glob.glob(<span class="ss">f'</span><span class="sc">{</span>fileDir<span class="sc">}{</span>os<span class="sc">.</span>path<span class="sc">.</span>sep<span class="sc">}</span><span class="ss">*.gfa'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['../../1001G/GraphCollapsing/TestGraphs/inversion_test_01.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/inversion_test_02.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/inversion_test_03.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/inversion_test_04.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/inversion_test_05.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/inversion_test_06.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/inversion_test_07.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/inversion_test_08.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/inversion_test_09.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/inversion_test_10.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_01.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_02.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_03.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_04.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_05.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_06.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_07.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_08.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_09.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_10.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_11.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/repeats_test_12.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/transposition_test_01.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/transposition_test_02.gfa',
 '../../1001G/GraphCollapsing/TestGraphs/transposition_test_03.gfa']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">'inversion_test_01.gfa'</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>inversionThreshold<span class="op">=</span><span class="fl">0.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> GenomeGraph(gfaPath<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>fileDir<span class="sc">}{</span>os<span class="sc">.</span>path<span class="sc">.</span>sep<span class="sc">}{</span>filename<span class="sc">}</span><span class="ss">'</span>,isGFASeq<span class="op">=</span><span class="va">False</span>, doBack<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loading graph from ../../1001G/GraphCollapsing/TestGraphs/inversion_test_01.gfa
Found node annotation file ../../1001G/GraphCollapsing/TestGraphs/annotation_inversion_test_01.dat, loading associations.
Loading segment 6/6
Loading segments finished.
Loading link 12/12
Loading links finished
Loading path 3/3
Loading paths finished. 3 paths added, 0 paths ignored.
Calculating nodes length...
Processing node 6/6
Finished calculating nodes lengths
Preprocessing paths...
Processing path 3/3
Finished preprocessing paths
</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>graph.paths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[['1+', '2+', '3+', '4-', '5+', '6+'],
 ['1+', '2-', '3+', '4+', '5+', '6+'],
 ['1+', '2+', '3+', '5-', '4+', '6+']]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>invStartPoints,graphEnds <span class="op">=</span> identifyPotentialInvStarts(graph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>graphEnds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[6]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>invStartPoints</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[(1, 2), (3, 4), (3, 5)]</code></pre>
</div>
</div>
<p>We follow links by the following rules: - The initiation link is <code>a+ -&gt; b-</code>. We get all nodes between <code>a</code> and <code>b</code> (exclusive) as search nodes. - Node <code>b</code> is added to the inversion stretch list. - Next node is either inverted node (irrespective of current search nodes) on normal node which is in current search nodes list. If there are several options, each option should be considered. Done through a special queue for each step. - (<em>) If node <code>c+</code> is found to be added to the stretch, and it is returning node, i.e.&nbsp;lets call max(search terms) as<code>d</code> and min(search terms) as <code>e</code>: - if <code>c&lt;d</code> and <code>c&lt;b</code> (the link to it goes to the left), then flip (meaning that if a node is in search terms, then remove it, otherwise, add it) in search terms all nodes between c and d (inclusive). - if <code>c&gt;e</code> and <code>c&gt;b</code> (the link to it goes to the right), then flip (meaning that if a node is in search terms, then remove it, otherwise, add it) in search terms all nodes between e and c (inclusive). - If we come through <code>x+ -&gt; y-</code> in the stretch, it should be removed from initiation links list (possibly, each of them should be processed separately, but after that the stretches from initiation links that were used in other stretched should be removed. - If in (</em>) all search terms are wiped, then <code>c+</code> will be the end edge of the stretch and stretch closed. - If there is no more options of either inverted node, or normal node from search nodes linked from current one, then this particular stretch is finished. In this case, the next closest normal node (not in the stretch, i.e.&nbsp;not in <code>min:max+1</code>) linked from current one is the right end of the stretch.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>processingQueue <span class="op">=</span> []</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>inversionBlocks <span class="op">=</span> []</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> invStart <span class="kw">in</span> invStartPoints:</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    blockStart <span class="op">=</span> invStart[<span class="dv">0</span>]</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    block <span class="op">=</span> []</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    blockEnd <span class="op">=</span> <span class="va">None</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    firstNode <span class="op">=</span> <span class="bu">min</span>(invStart)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    lastNode <span class="op">=</span> <span class="bu">max</span>(invStart)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    searchNodes <span class="op">=</span> <span class="bu">set</span>(<span class="bu">range</span>(firstNode<span class="op">+</span><span class="dv">1</span>,lastNode))</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    curNode,curDir <span class="op">=</span> invStart[<span class="dv">1</span>],<span class="st">'-'</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> blockEnd <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>        nextNodes <span class="op">=</span> graph.forwardLinks[curNode][<span class="st">'curDir'</span>]</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(searchNodes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[]
[]
[4]</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>